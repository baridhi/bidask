# Pseudocode

This file provides the pseudocode to simplify implementations of [EDGE](https://www.ssrn.com/abstract=3892335) in any programming language. 

### Input

`O`, `H`, `L`, `C` vectors of Open, High, Low, and Close prices. The vectors must be sorted in ascending order of the timestamp.

### Output

Numeric spread estimate.

### Algorithm

1. Convert the `O`, `H`, `L`, `C` vectors to logs 
   1. `o = log(O)`
   2. `h = log(H)`
   3. `l = log(L)`
   4. `c = log(C)`

2. Compute the mid prices 
   1. `m = (h+l)/2`

3. Lag the vectors of one period 
   1. `c1 = lag(c)`
   2. `m1 = lag(m)` 
   3. `h1 = lag(h)` 
   4. `l1 = lag(l)`

4. Compute the  vectors:
   1. `r1 = m-o`
   2. `r2 = o-m1`
   3. `r3 = m-c1`
   4. `r4 = c1-m1`
   5. `r5 = o-c1`

5. Compute the vectors:
   1. `z1 = r1*r2 + r3*r4`  
   2. `z2 = r1*r5 + r5*r4`

6. Compute the following indicator variables that equal 1 if:
   1. The high differs from the low, or the low differs from the previous close:  `tau = h!=l | l!=c1 ` 
   2. Same as 1. and the open differs from the high: `phi1 = o!=h & tau`
   3. Same as 1. and the open differs from the low: `phi2 = o!=l & tau`
   4. Same as 1. and the previous close differs from the previous high: `phi3 = c1!=h1 & tau`
   5. Same as 1. and the previous close differs from the previous low: `phi4 = c1!=l1 & tau`

7. Compute the means:
   1. `m1 = mean(z1)`
   2. `m2 = mean(z2)`
   3. `m3 = mean(z1^2)`
   4. `m4 = mean(z2^2)`
   5. `m5 = mean(r1)`
   6. `m6 = mean(r2*tau)`
   7. `m7 = mean(r3)`
   8. `m8 = mean(r4*tau)`
   9. `m9 = mean(r5)`
   10. `m10 = mean(tau)`
   11. `m11 = mean(phi1)`
   12. `m12 = mean(phi2)`
   13. `m13 = mean(phi3)`
   14. `m14 = mean(phi4)`

8. Compute the total number of non-missing observations 
   1. `n = sum(!is.na(z1))`

9. Compute the variances 
    1. `v1 = m3 - m1^2`  
    2. `v2 = m4 - m2^2`

10. Compute the weights 
    1. `w1 = v2/(v1+v2)`  
    2. `w2 = v1/(v1+v2)`

11. Compute the coefficients 
    1. `p1 = -1/8 * (m11+m12)`  
    2. `p2 = -1/8 * (m13+m14)`

12. Compute the square spread 
    1. `s2 = n/(n-1) * (w1 * (m1 - (m5*m6 + m7*m8) / m10) + w2 * (m2 - (m9*m5 + m8*m9) / m10)) / (p1 + p2))`

13. Return the square root of the absolute value of the square spread 
    1. `s = sqrt(abs(s2))`


### Testing

To check the implementation is correct, import the data available at:

- https://raw.githubusercontent.com/eguidotti/bidask/main/pseudocode/ohlc.csv

This file contains sample OHLC simulated price data to simplify testing. The data have been generated by simulating a price process as described in Ardia-Guidotti-Kroencke (2021) with 390 trades per day and a 1% probability to observe a trade. The simulation uses a constant spread of 1%.

Run the estimation. You should obtain a spread estimate of **0.01019485**. If you obtain a different results, you may use the following table to check and debug the intermediate steps.

| variable | value                |
| -------- | -------------------- |
| `m1`     | -3.260523e-05        |
| `m2`     | -3.097027e-05        |
| `m3`     | 1.930106e-07         |
| `m4`     | 1.25487e-07          |
| `m5`     | 0.0002057916         |
| `m6`     | -9.99543e-06         |
| `m7`     | 0.0001578149         |
| `m8`     | 3.798122e-05         |
| `m9`     | -4.797665e-05        |
| `m10`    | 0.9820982            |
| `m11`    | 0.6184618            |
| `m12`    | 0.6094609            |
| `m13`    | 0.6036604            |
| `m14`    | 0.6015602            |
| `n`      | 9999                 |
| `v1`     | 1.919475e-07         |
| `v2`     | 1.245278e-07         |
| `w1`     | 0.3934835            |
| `w2`     | 0.6065165            |
| `p1`     | -0.153490349034903   |
| `p2`     | -0.150652565256526   |
| `s2`     | 0.000103935068182426 |

### Contribute

Have you implemented EDGE in a new programming language? If you want your implementation to be included in this repository, please open a [pull request](https://github.com/eguidotti/bidask/pulls) 